<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Sample QC | A primer in Human Cardiovascular Genetics</title>
  <meta name="description" content="This is a primer in Human Cardiovascular Genetics. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.25 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Sample QC | A primer in Human Cardiovascular Genetics" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a primer in Human Cardiovascular Genetics. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="swvanderlaan/A_primer_in_Human_Cardiovascular_Genetics" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Sample QC | A primer in Human Cardiovascular Genetics" />
  
  <meta name="twitter:description" content="This is a primer in Human Cardiovascular Genetics. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="dr. Sander W. van der Laan  " />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="basics-of-a-genome-wide-association-study-gwas.html"/>
<link rel="next" href="per-snp-qc.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A primer in Human Cardiovascular Genetics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About this primer<span></span></a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction<span></span></a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#background-reading"><i class="fa fa-check"></i><b>1.2</b> Background reading<span></span></a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#meet-the-team"><i class="fa fa-check"></i><b>1.3</b> Meet the Team<span></span></a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#final-thoughts"><i class="fa fa-check"></i><b>1.4</b> Final thoughts<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="prerequisites.html"><a href="prerequisites.html"><i class="fa fa-check"></i><b>2</b> Prerequisites<span></span></a>
<ul>
<li class="chapter" data-level="2.1" data-path="prerequisites.html"><a href="prerequisites.html#linux-macos-and-windows"><i class="fa fa-check"></i><b>2.1</b> Linux, macOS, and Windows<span></span></a></li>
<li class="chapter" data-level="2.2" data-path="prerequisites.html"><a href="prerequisites.html#programs-you-need"><i class="fa fa-check"></i><b>2.2</b> Programs you need<span></span></a></li>
<li class="chapter" data-level="2.3" data-path="prerequisites.html"><a href="prerequisites.html#the-terminal"><i class="fa fa-check"></i><b>2.3</b> The Terminal<span></span></a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="prerequisites.html"><a href="prerequisites.html#download-the-data"><i class="fa fa-check"></i><b>2.3.1</b> Download the data<span></span></a></li>
<li class="chapter" data-level="2.3.2" data-path="prerequisites.html"><a href="prerequisites.html#navigating-the-terminal"><i class="fa fa-check"></i><b>2.3.2</b> Navigating the Terminal<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="prerequisites.html"><a href="prerequisites.html#installing-some-r-packages"><i class="fa fa-check"></i><b>2.4</b> Installing some R packages<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="basics-of-a-genome-wide-association-study-gwas.html"><a href="basics-of-a-genome-wide-association-study-gwas.html"><i class="fa fa-check"></i><b>3</b> Basics of a Genome-Wide Association Study (GWAS)<span></span></a>
<ul>
<li class="chapter" data-level="3.1" data-path="basics-of-a-genome-wide-association-study-gwas.html"><a href="basics-of-a-genome-wide-association-study-gwas.html#converting-datasets"><i class="fa fa-check"></i><b>3.1</b> Converting datasets<span></span></a></li>
<li class="chapter" data-level="3.2" data-path="basics-of-a-genome-wide-association-study-gwas.html"><a href="basics-of-a-genome-wide-association-study-gwas.html#quality-control"><i class="fa fa-check"></i><b>3.2</b> Quality control<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="sample-qc.html"><a href="sample-qc.html"><i class="fa fa-check"></i><b>4</b> Sample QC<span></span></a>
<ul>
<li class="chapter" data-level="4.1" data-path="sample-qc.html"><a href="sample-qc.html#sex"><i class="fa fa-check"></i><b>4.1</b> Sex<span></span></a></li>
<li class="chapter" data-level="4.2" data-path="sample-qc.html"><a href="sample-qc.html#sample-callrates"><i class="fa fa-check"></i><b>4.2</b> Sample Callrates<span></span></a></li>
<li class="chapter" data-level="4.3" data-path="sample-qc.html"><a href="sample-qc.html#heterozygosity-rate"><i class="fa fa-check"></i><b>4.3</b> Heterozygosity rate<span></span></a></li>
<li class="chapter" data-level="4.4" data-path="sample-qc.html"><a href="sample-qc.html#relatedness"><i class="fa fa-check"></i><b>4.4</b> Relatedness<span></span></a></li>
<li class="chapter" data-level="4.5" data-path="sample-qc.html"><a href="sample-qc.html#ancestral-background"><i class="fa fa-check"></i><b>4.5</b> Ancestral background<span></span></a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="sample-qc.html"><a href="sample-qc.html#hapmap-3"><i class="fa fa-check"></i><b>4.5.1</b> HapMap 3<span></span></a></li>
<li class="chapter" data-level="4.5.2" data-path="sample-qc.html"><a href="sample-qc.html#principal-component-analysis"><i class="fa fa-check"></i><b>4.5.2</b> Principal Component Analysis<span></span></a></li>
<li class="chapter" data-level="4.5.3" data-path="sample-qc.html"><a href="sample-qc.html#g-phase-1"><i class="fa fa-check"></i><b>4.5.3</b> 1000G phase 1<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="sample-qc.html"><a href="sample-qc.html#removing-samples"><i class="fa fa-check"></i><b>4.6</b> Removing samples<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="per-snp-qc.html"><a href="per-snp-qc.html"><i class="fa fa-check"></i><b>5</b> Per-SNP QC<span></span></a>
<ul>
<li class="chapter" data-level="5.1" data-path="per-snp-qc.html"><a href="per-snp-qc.html#snp-call-rates"><i class="fa fa-check"></i><b>5.1</b> SNP call rates<span></span></a></li>
<li class="chapter" data-level="5.2" data-path="per-snp-qc.html"><a href="per-snp-qc.html#differential-snp-call-rates"><i class="fa fa-check"></i><b>5.2</b> Differential SNP call rates<span></span></a></li>
<li class="chapter" data-level="5.3" data-path="per-snp-qc.html"><a href="per-snp-qc.html#allele-frequencies"><i class="fa fa-check"></i><b>5.3</b> Allele frequencies<span></span></a></li>
<li class="chapter" data-level="5.4" data-path="per-snp-qc.html"><a href="per-snp-qc.html#hardy-weinberg-equilibrium"><i class="fa fa-check"></i><b>5.4</b> Hardy-Weinberg Equilibrium<span></span></a></li>
<li class="chapter" data-level="5.5" data-path="per-snp-qc.html"><a href="per-snp-qc.html#final-snp-qc"><i class="fa fa-check"></i><b>5.5</b> Final SNP QC<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="genome-wide-association-study.html"><a href="genome-wide-association-study.html"><i class="fa fa-check"></i><b>6</b> Genome-wide association study<span></span></a>
<ul>
<li class="chapter" data-level="6.1" data-path="genome-wide-association-study.html"><a href="genome-wide-association-study.html#exploring-the-data"><i class="fa fa-check"></i><b>6.1</b> Exploring the data<span></span></a></li>
<li class="chapter" data-level="6.2" data-path="genome-wide-association-study.html"><a href="genome-wide-association-study.html#genetic-models"><i class="fa fa-check"></i><b>6.2</b> Genetic models<span></span></a></li>
<li class="chapter" data-level="6.3" data-path="genome-wide-association-study.html"><a href="genome-wide-association-study.html#logistic-regression"><i class="fa fa-check"></i><b>6.3</b> Logistic regression<span></span></a></li>
<li class="chapter" data-level="6.4" data-path="genome-wide-association-study.html"><a href="genome-wide-association-study.html#gwas-visualisation"><i class="fa fa-check"></i><b>6.4</b> GWAS visualisation<span></span></a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="genome-wide-association-study.html"><a href="genome-wide-association-study.html#qq-plots"><i class="fa fa-check"></i><b>6.4.1</b> QQ plots<span></span></a></li>
<li class="chapter" data-level="6.4.2" data-path="genome-wide-association-study.html"><a href="genome-wide-association-study.html#manhattan-plots"><i class="fa fa-check"></i><b>6.4.2</b> Manhattan plots<span></span></a></li>
<li class="chapter" data-level="6.4.3" data-path="genome-wide-association-study.html"><a href="genome-wide-association-study.html#other-plots"><i class="fa fa-check"></i><b>6.4.3</b> Other plots<span></span></a></li>
<li class="chapter" data-level="6.4.4" data-path="genome-wide-association-study.html"><a href="genome-wide-association-study.html#interactive-plots"><i class="fa fa-check"></i><b>6.4.4</b> Interactive plots<span></span></a></li>
<li class="chapter" data-level="6.4.5" data-path="genome-wide-association-study.html"><a href="genome-wide-association-study.html#regional-association-plots"><i class="fa fa-check"></i><b>6.4.5</b> Regional association plots<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="wtccc1-a-gwas-on-coronary-artery-disease-cad.html"><a href="wtccc1-a-gwas-on-coronary-artery-disease-cad.html"><i class="fa fa-check"></i><b>7</b> WTCCC1: a GWAS on coronary artery disease (CAD)<span></span></a>
<ul>
<li class="chapter" data-level="7.1" data-path="wtccc1-a-gwas-on-coronary-artery-disease-cad.html"><a href="wtccc1-a-gwas-on-coronary-artery-disease-cad.html#section-1"><i class="fa fa-check"></i><b>7.1</b> Section 1<span></span></a></li>
<li class="chapter" data-level="7.2" data-path="wtccc1-a-gwas-on-coronary-artery-disease-cad.html"><a href="wtccc1-a-gwas-on-coronary-artery-disease-cad.html#section-2"><i class="fa fa-check"></i><b>7.2</b> Section 2<span></span></a></li>
<li class="chapter" data-level="7.3" data-path="wtccc1-a-gwas-on-coronary-artery-disease-cad.html"><a href="wtccc1-a-gwas-on-coronary-artery-disease-cad.html#section-3"><i class="fa fa-check"></i><b>7.3</b> Section 3<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="post-gwas-analyses.html"><a href="post-gwas-analyses.html"><i class="fa fa-check"></i><b>8</b> Post-GWAS Analyses<span></span></a>
<ul>
<li class="chapter" data-level="8.1" data-path="post-gwas-analyses.html"><a href="post-gwas-analyses.html#section-1-1"><i class="fa fa-check"></i><b>8.1</b> Section 1<span></span></a></li>
<li class="chapter" data-level="8.2" data-path="post-gwas-analyses.html"><a href="post-gwas-analyses.html#section-2-1"><i class="fa fa-check"></i><b>8.2</b> Section 2<span></span></a></li>
<li class="chapter" data-level="8.3" data-path="post-gwas-analyses.html"><a href="post-gwas-analyses.html#section-3-1"><i class="fa fa-check"></i><b>8.3</b> Section 3<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="conditional-analysis.html"><a href="conditional-analysis.html"><i class="fa fa-check"></i><b>9</b> Conditional analysis<span></span></a>
<ul>
<li class="chapter" data-level="9.1" data-path="conditional-analysis.html"><a href="conditional-analysis.html#section-1-2"><i class="fa fa-check"></i><b>9.1</b> Section 1<span></span></a></li>
<li class="chapter" data-level="9.2" data-path="conditional-analysis.html"><a href="conditional-analysis.html#section-2-2"><i class="fa fa-check"></i><b>9.2</b> Section 2<span></span></a></li>
<li class="chapter" data-level="9.3" data-path="conditional-analysis.html"><a href="conditional-analysis.html#section-3-2"><i class="fa fa-check"></i><b>9.3</b> Section 3<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="statistical-finemapping.html"><a href="statistical-finemapping.html"><i class="fa fa-check"></i><b>10</b> Statistical finemapping<span></span></a>
<ul>
<li class="chapter" data-level="10.1" data-path="statistical-finemapping.html"><a href="statistical-finemapping.html#section-1-3"><i class="fa fa-check"></i><b>10.1</b> Section 1<span></span></a></li>
<li class="chapter" data-level="10.2" data-path="statistical-finemapping.html"><a href="statistical-finemapping.html#section-2-3"><i class="fa fa-check"></i><b>10.2</b> Section 2<span></span></a></li>
<li class="chapter" data-level="10.3" data-path="statistical-finemapping.html"><a href="statistical-finemapping.html#section-3-3"><i class="fa fa-check"></i><b>10.3</b> Section 3<span></span></a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="functional-mapping-and-annotation-of-gwas.html"><a href="functional-mapping-and-annotation-of-gwas.html"><i class="fa fa-check"></i><b>11</b> Functional Mapping and Annotation of GWAS<span></span></a>
<ul>
<li class="chapter" data-level="11.1" data-path="functional-mapping-and-annotation-of-gwas.html"><a href="functional-mapping-and-annotation-of-gwas.html#section-1-4"><i class="fa fa-check"></i><b>11.1</b> Section 1<span></span></a></li>
<li class="chapter" data-level="11.2" data-path="functional-mapping-and-annotation-of-gwas.html"><a href="functional-mapping-and-annotation-of-gwas.html#section-2-4"><i class="fa fa-check"></i><b>11.2</b> Section 2<span></span></a></li>
<li class="chapter" data-level="11.3" data-path="functional-mapping-and-annotation-of-gwas.html"><a href="functional-mapping-and-annotation-of-gwas.html#section-3-4"><i class="fa fa-check"></i><b>11.3</b> Section 3<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="phenome-wide-association-study-phewas.html"><a href="phenome-wide-association-study-phewas.html"><i class="fa fa-check"></i><b>12</b> Phenome-Wide Association Study (PheWAS)<span></span></a>
<ul>
<li class="chapter" data-level="12.1" data-path="phenome-wide-association-study-phewas.html"><a href="phenome-wide-association-study-phewas.html#section-1-5"><i class="fa fa-check"></i><b>12.1</b> Section 1<span></span></a></li>
<li class="chapter" data-level="12.2" data-path="phenome-wide-association-study-phewas.html"><a href="phenome-wide-association-study-phewas.html#section-2-5"><i class="fa fa-check"></i><b>12.2</b> Section 2<span></span></a></li>
<li class="chapter" data-level="12.3" data-path="phenome-wide-association-study-phewas.html"><a href="phenome-wide-association-study-phewas.html#section-3-5"><i class="fa fa-check"></i><b>12.3</b> Section 3<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="mendelian-randomization-mr.html"><a href="mendelian-randomization-mr.html"><i class="fa fa-check"></i><b>13</b> Mendelian Randomization (MR)<span></span></a>
<ul>
<li class="chapter" data-level="13.1" data-path="mendelian-randomization-mr.html"><a href="mendelian-randomization-mr.html#section-1-6"><i class="fa fa-check"></i><b>13.1</b> Section 1<span></span></a></li>
<li class="chapter" data-level="13.2" data-path="mendelian-randomization-mr.html"><a href="mendelian-randomization-mr.html#section-2-6"><i class="fa fa-check"></i><b>13.2</b> Section 2<span></span></a></li>
<li class="chapter" data-level="13.3" data-path="mendelian-randomization-mr.html"><a href="mendelian-randomization-mr.html#section-3-6"><i class="fa fa-check"></i><b>13.3</b> Section 3<span></span></a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="mendelian-randomization-mr-1.html"><a href="mendelian-randomization-mr-1.html"><i class="fa fa-check"></i><b>14</b> Mendelian Randomization (MR)<span></span></a>
<ul>
<li class="chapter" data-level="14.1" data-path="mendelian-randomization-mr-1.html"><a href="mendelian-randomization-mr-1.html#section-1-7"><i class="fa fa-check"></i><b>14.1</b> Section 1<span></span></a></li>
<li class="chapter" data-level="14.2" data-path="mendelian-randomization-mr-1.html"><a href="mendelian-randomization-mr-1.html#section-2-7"><i class="fa fa-check"></i><b>14.2</b> Section 2<span></span></a></li>
<li class="chapter" data-level="14.3" data-path="mendelian-randomization-mr-1.html"><a href="mendelian-randomization-mr-1.html#section-3-7"><i class="fa fa-check"></i><b>14.3</b> Section 3<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="license-your-gitbook.html"><a href="license-your-gitbook.html"><i class="fa fa-check"></i><b>15</b> License your GitBook<span></span></a></li>
<li class="chapter" data-level="16" data-path="license-your-gitbook-1.html"><a href="license-your-gitbook-1.html"><i class="fa fa-check"></i><b>16</b> License your GitBook<span></span></a></li>
<li><a href="references.html#references">References<span></span></a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A primer in Human Cardiovascular Genetics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="sample-qc" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Sample QC<a href="sample-qc.html#sample-qc" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Let’s start with the per-sample quality control.</p>
<div id="sex" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Sex<a href="sample-qc.html#sex" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We need to identify of individuals with discordant sex information comparing phenotypic and genotypic data. Let’s calculate the mean homozygosity rate across X-chromosome markers for each individual in the study.</p>
<pre><code>plink --bfile rawdata/rawdata --check-sex --out rawdata/rawdata
</code></pre>
<p>This produces a file with the following columns:</p>
<ul>
<li><em>FID</em> Family ID</li>
<li><em>IID</em> Within-family ID</li>
<li><em>PEDSEX</em> Sex code in input file</li>
<li><em>SNPSEX</em> Imputed sex code (1 = male, 2 = female, 0 = unknown)</li>
<li><em>STATUS</em> ‘OK’ if PEDSEX and SNPSEX match and are nonzero, ‘PROBLEM’ otherwise</li>
<li><em>F</em> Inbreeding coefficient, considering only X chromosome. Not present with ‘y-only’.</li>
<li><em>YCOUNT</em> Number of nonmissing genotype calls on Y chromosome. Requires ‘ycount’/‘y-only’.</li>
</ul>
<p>We need to get a list of individuals with discordant sex data.</p>
<pre><code>cat rawdata/rawdata.sexcheck | awk &#39;$5 ==&quot;STATUS&quot; || $5 ==&quot;PROBLEM&quot;&#39;  &gt; rawdata/rawdata.sexprobs.txt</code></pre>
<p>Let’s have a look at the results.</p>
<pre><code>cat rawdata/rawdata.sexprobs.txt</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="sample-qc.html#cb16-1" aria-hidden="true" tabindex="-1"></a>sexissues <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="fu">paste0</span>(COURSE_loc,<span class="st">&quot;/rawdata/rawdata.sexprobs.txt&quot;</span>))</span>
<span id="cb16-2"><a href="sample-qc.html#cb16-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(sexissues, <span class="at">caption =</span> <span class="st">&quot;Sex issues&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-1">Table 4.1: </span>Sex issues</caption>
<thead>
<tr class="header">
<th align="right">FID</th>
<th align="right">IID</th>
<th align="right">PEDSEX</th>
<th align="right">SNPSEX</th>
<th align="left">STATUS</th>
<th align="right">F</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">772</td>
<td align="right">772</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="left">PROBLEM</td>
<td align="right">0.3084</td>
</tr>
<tr class="even">
<td align="right">853</td>
<td align="right">853</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="left">PROBLEM</td>
<td align="right">0.3666</td>
</tr>
<tr class="odd">
<td align="right">1920</td>
<td align="right">1920</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="left">PROBLEM</td>
<td align="right">0.4066</td>
</tr>
</tbody>
</table>
<p>When the homozygosity rate (<em>F</em>) is more than 0.2, but less than 0.8, the genotype data are inconclusive regarding the sex of an individual and these are marked in column <em>SNPSEX</em> with a 0, and the column <em>STATUS</em> “PROBLEM”.</p>
<p>Report the IDs of individuals with discordant sex information to those who conducted sex phenotyping. In situations in which discrepancy cannot be resolved, add the family ID (FID) and individual ID (IID) of the samples to a file named “fail-sexcheck-qc.txt” (one individual per line, tab delimited).</p>
<pre><code>grep &quot;PROBLEM&quot; rawdata/rawdata.sexcheck | awk &#39;{ print $1, $2}&#39;  &gt; rawdata/fail-sexcheck-qc.txt
</code></pre>
</div>
<div id="sample-callrates" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Sample Callrates<a href="sample-qc.html#sample-callrates" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s get an overview of the missing data per sample and per SNP.</p>
<pre><code>plink --bfile rawdata/rawdata --missing --out rawdata/rawdata
</code></pre>
<p>This produces two files, <code>rawdata/rawdata.imiss</code> and <code>rawdata/rawdata.lmiss</code>. In the .imiss file the <em>N_MISS</em> column denotes the number of missing SNPs, and the <em>F_MISS</em> column denotes the proportion of missing SNPs per individual.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="sample-qc.html#cb19-1" aria-hidden="true" tabindex="-1"></a>raw_IMISS <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="fu">paste0</span>(COURSE_loc, <span class="st">&quot;/rawdata/rawdata.imiss&quot;</span>))</span>
<span id="cb19-2"><a href="sample-qc.html#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="sample-qc.html#cb19-3" aria-hidden="true" tabindex="-1"></a>raw_IMISS<span class="sc">$</span>callrate <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> raw_IMISS<span class="sc">$</span>F_MISS</span>
<span id="cb19-4"><a href="sample-qc.html#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="sample-qc.html#cb19-5" aria-hidden="true" tabindex="-1"></a>ggpubr<span class="sc">::</span><span class="fu">gghistogram</span>(raw_IMISS, <span class="at">x =</span> <span class="st">&quot;callrate&quot;</span>,</span>
<span id="cb19-6"><a href="sample-qc.html#cb19-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">add =</span> <span class="st">&quot;mean&quot;</span>, <span class="at">add.params =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">&quot;#595A5C&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>),</span>
<span id="cb19-7"><a href="sample-qc.html#cb19-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">bins =</span> <span class="dv">50</span>,</span>
<span id="cb19-8"><a href="sample-qc.html#cb19-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">color =</span> <span class="st">&quot;#1290D9&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;#1290D9&quot;</span>,</span>
<span id="cb19-9"><a href="sample-qc.html#cb19-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xlab =</span> <span class="st">&quot;per sample call rate&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-10"><a href="sample-qc.html#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.95</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb19-11"><a href="sample-qc.html#cb19-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">&quot;#E55738&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## Warning: geom_vline(): Ignoring `mapping` because `xintercept` was provided.</code></pre>
<pre><code>## Warning: geom_vline(): Ignoring `data` because `xintercept` was provided.</code></pre>
<p><img src="A-primer-in-Human-Cardiovascular-Genetics_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>The grey dashed line indicates the mean call rate, while the red dashed line indicates the threshold we had determined above.</p>
</div>
<div id="heterozygosity-rate" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Heterozygosity rate<a href="sample-qc.html#heterozygosity-rate" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To properly calculate heterozygosity rate and relatedness (identity-by-descent [IBD]) we need to do four things:</p>
<ol style="list-style-type: decimal">
<li>pre-clean the data to get a high-quality set,</li>
<li>of independent SNPs,</li>
<li>exclude long-range linkage disequilibrium (LD) blocks that bias with these calculations, and</li>
<li>exclude A/T and C/G SNPs as these may be ambivalent in interpretation when frequencies between cases and controls are close (MAF ± 0.45),</li>
<li>remove all non-autosomal SNPs.</li>
</ol>
<p>We will use the following settings:</p>
<ul>
<li>remove A/T and C/G SNPs with the flag <code>--exclude rawdata/all.atcg.variants.txt</code>,</li>
<li>call rate &lt;1% with the flag <code>--geno 0.10</code>,</li>
<li>Hardy-Weinberg Equilibrium (HWE) p-value &gt; 1x10-3 with the flag <code>--hwe 1e-3</code>,</li>
<li>and MAF&gt;10% with the flag <code>--maf 0.10</code>,</li>
<li>prune the data to only select independent SNPs (with low LD r^2) of one pair each with <code>r^2 = 0.2</code> with the flags <code>--indep-pairwise 100 10 0.2</code> and <code>--extract rawdata/raw-GWA-data.prune.in</code>,</li>
<li>SNPs in long-range LD regions (for example: MHC chr 6 25.8-36Mb, chr 8 inversion 6-16Mb, chr17 40-45Mb, and a few more) with the flag <code>--exclude range rawdata/exclude_problematic_range.txt</code>,</li>
<li>remove non-autosomal SNPs with the flag <code>--allow-no-sex --autosome</code>.</li>
</ul>
<p>First, get a list of A/T and C/G SNPs.</p>
<pre><code>cat rawdata/rawdata.bim | \
awk &#39;($5 == &quot;A&quot; &amp;&amp; $6 == &quot;T&quot;) || ($5 == &quot;T&quot; &amp;&amp; $6 == &quot;A&quot;) || ($5 == &quot;C&quot; &amp;&amp; $6 == &quot;G&quot;) || ($5 == &quot;G&quot; &amp;&amp; $6 == &quot;C&quot;)&#39; | awk &#39;{ print $2, $1, $4, $3, $5, $6 }&#39; \
&gt; rawdata/all.atcg.variants.txt</code></pre>
<p>Second, clean the data and get a list of independent SNPs.</p>
<!-- *NEXT YEAR: further explain the exact commands  and how they relate with the above.* -->
<pre><code>plink --bfile rawdata/rawdata \
--allow-no-sex --autosome \
--maf 0.10 --geno 0.10 --hwe 1e-3 \
--indep-pairwise 100 10 0.2 \
--exclude range rawdata/exclude_problematic_range.txt \
--make-bed --out rawdata/rawdata.clean.temp</code></pre>
<blockquote>
<p>Please note, we have create a dataset without taking into account LD structure. Thus the flag <code>--indep-pairwise 100 10 0.2</code> doesn’t actually work. However, with real-data you can use it to prune out unwanted SNPs in high LD.</p>
</blockquote>
<p>Third, exclude the pruned SNPs. Note, how we include a file to exclude high-LD for the purpose of the practical.</p>
<pre><code>plink --bfile rawdata/rawdata.clean.temp \
--extract rawdata/raw-GWA-data.prune.in \
--make-bed --out rawdata/rawdata.clean.ultraclean.temp
</code></pre>
<p>Fourth, remove the A/T and C/G SNPs.</p>
<pre><code>plink --bfile rawdata/rawdata.clean.ultraclean.temp \
--exclude rawdata/all.atcg.variants.txt \
--make-bed --out rawdata/rawdata.clean.ultraclean</code></pre>
<blockquote>
<p>Please note, this dataset doesn’t actually include this type of SNP, hence <code>rawdata/all.atcg.variants.txt</code> is empty! Again, you can use this command in real-data to exclude A/T and C/G SNPs.</p>
</blockquote>
<p>Lastly, remove the temporary files.</p>
<pre><code>rm -v rawdata/*.temp*
</code></pre>
<p>Finally, we can calculate the heterozygosity rate.</p>
<pre><code>plink --bfile rawdata/rawdata.clean.ultraclean --het --out rawdata/rawdata.clean.ultraclean</code></pre>
<p>This creates the file <code>rawdata/rawdata.clean.ultraclean.het</code>, in which the third column denotes the observed number of homozygous genotypes, O(Hom), and the fifth column denotes the number of nonmissing genotypes, N(NM), per individual. We can now calculate the observed heterozygosity rate per individual using the formula (N(NM) - O(Hom))/N(NM).</p>
<p>Often there is a correlation between heterozygosity rate and missing data. Thus, we should plot the observed heterozygosity rate per individual on the x-axis and the proportion of missing SNP, that is the ‘SNP call rate’, per individuals on the y-axis.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="sample-qc.html#cb28-1" aria-hidden="true" tabindex="-1"></a>raw_HET <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="fu">paste0</span>(COURSE_loc, <span class="st">&quot;/rawdata/rawdata.clean.ultraclean.het&quot;</span>))</span>
<span id="cb28-2"><a href="sample-qc.html#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="sample-qc.html#cb28-3" aria-hidden="true" tabindex="-1"></a>raw_IMISS<span class="sc">$</span>logF_MISS <span class="ot">=</span> <span class="fu">log10</span>(raw_IMISS<span class="sc">$</span>F_MISS)</span>
<span id="cb28-4"><a href="sample-qc.html#cb28-4" aria-hidden="true" tabindex="-1"></a>prop_miss <span class="ot">=</span> <span class="sc">-</span><span class="fl">1.522879</span></span>
<span id="cb28-5"><a href="sample-qc.html#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="sample-qc.html#cb28-6" aria-hidden="true" tabindex="-1"></a>raw_HET<span class="sc">$</span>meanHet <span class="ot">=</span> (raw_HET<span class="sc">$</span><span class="st">`</span><span class="at">N(NM)</span><span class="st">`</span> <span class="sc">-</span> raw_HET<span class="sc">$</span><span class="st">`</span><span class="at">O(HOM)</span><span class="st">`</span>)<span class="sc">/</span>raw_HET<span class="sc">$</span><span class="st">`</span><span class="at">N(NM)</span><span class="st">`</span></span>
<span id="cb28-7"><a href="sample-qc.html#cb28-7" aria-hidden="true" tabindex="-1"></a>lower_meanHet <span class="ot">=</span> <span class="fu">mean</span>(raw_HET<span class="sc">$</span>meanHet) <span class="sc">-</span> (<span class="dv">2</span><span class="sc">*</span><span class="fu">sd</span>(raw_HET<span class="sc">$</span>meanHet))</span>
<span id="cb28-8"><a href="sample-qc.html#cb28-8" aria-hidden="true" tabindex="-1"></a>upper_meanHet <span class="ot">=</span> <span class="fu">mean</span>(raw_HET<span class="sc">$</span>meanHet) <span class="sc">+</span> (<span class="dv">2</span><span class="sc">*</span><span class="fu">sd</span>(raw_HET<span class="sc">$</span>meanHet))</span>
<span id="cb28-9"><a href="sample-qc.html#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="sample-qc.html#cb28-10" aria-hidden="true" tabindex="-1"></a>raw_IMISSHET <span class="ot">=</span> <span class="fu">merge</span>(raw_IMISS, raw_HET, <span class="at">by =</span> <span class="st">&quot;IID&quot;</span>)</span>
<span id="cb28-11"><a href="sample-qc.html#cb28-11" aria-hidden="true" tabindex="-1"></a>raw_IMISSHET<span class="sc">$</span>FID.y <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb28-12"><a href="sample-qc.html#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(raw_IMISSHET)[<span class="fu">colnames</span>(raw_IMISSHET)<span class="sc">==</span><span class="st">&quot;FID.x&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;FID&quot;</span></span>
<span id="cb28-13"><a href="sample-qc.html#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="sample-qc.html#cb28-14" aria-hidden="true" tabindex="-1"></a>colors  <span class="ot">&lt;-</span> <span class="fu">densCols</span>(raw_IMISSHET<span class="sc">$</span>logF_MISS, raw_IMISSHET<span class="sc">$</span>meanHet)</span></code></pre></div>
<pre><code>## Warning in KernSmooth::bkde2D(x, bandwidth = bandwidth, gridsize = nbin, :
## Binning grid too coarse for current (small) bandwidth: consider increasing
## &#39;gridsize&#39;</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="sample-qc.html#cb30-1" aria-hidden="true" tabindex="-1"></a>ggpubr<span class="sc">::</span><span class="fu">ggscatter</span>(raw_IMISSHET, <span class="at">x =</span> <span class="st">&quot;logF_MISS&quot;</span>, <span class="at">y =</span> <span class="st">&quot;meanHet&quot;</span>,</span>
<span id="cb30-2"><a href="sample-qc.html#cb30-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> colors,</span>
<span id="cb30-3"><a href="sample-qc.html#cb30-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xlab =</span> <span class="st">&quot;Proportion of missing genotypes&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Heterozygosity rate&quot;</span>) <span class="sc">+</span></span>
<span id="cb30-4"><a href="sample-qc.html#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;-3&quot;</span> <span class="ot">=</span> <span class="st">&quot;0.001&quot;</span>, <span class="st">&quot;-2&quot;</span> <span class="ot">=</span> <span class="st">&quot;0.01&quot;</span>,</span>
<span id="cb30-5"><a href="sample-qc.html#cb30-5" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;-1&quot;</span> <span class="ot">=</span> <span class="st">&quot;0.1&quot;</span>, <span class="st">&quot;0&quot;</span> <span class="ot">=</span> <span class="st">&quot;1&quot;</span>)) <span class="sc">+</span></span>
<span id="cb30-6"><a href="sample-qc.html#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> lower_meanHet, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb30-7"><a href="sample-qc.html#cb30-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">&quot;#E55738&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb30-8"><a href="sample-qc.html#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> upper_meanHet, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb30-9"><a href="sample-qc.html#cb30-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">&quot;#E55738&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb30-10"><a href="sample-qc.html#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> prop_miss, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb30-11"><a href="sample-qc.html#cb30-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">&quot;#E55738&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## Warning in if (color %in% names(data) &amp; is.null(add.params$color))
## add.params$color &lt;- color: the condition has length &gt; 1 and only the first
## element will be used</code></pre>
<p><img src="A-primer-in-Human-Cardiovascular-Genetics_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<!-- This is also available as script in the `wtccc_nature_protocols/quality_control` directory. -->
<p>Examine the plot to decide reasonable thresholds at which to exclude individuals based on elevated missing or extreme heterozygosity. We chose to exclude all individuals with a genotype failure rate &gt;= 0.03 (vertical dashed line) and/or a heterozygosity rate ± 3 s.d. from the mean (horizontal dashed lines). Add the FID and IID of the samples failing this QC to the file named <code>fail-imisshet-qc.txt</code>.</p>
<blockquote>
<p>How would you create this file?</p>
</blockquote>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="sample-qc.html#cb32-1" aria-hidden="true" tabindex="-1"></a>raw_IMISSHETsub <span class="ot">=</span> <span class="fu">subset</span>(raw_IMISSHET, logF_MISS <span class="sc">&gt;</span> prop_miss <span class="sc">|</span> (meanHet <span class="sc">&lt;</span> lower_meanHet <span class="sc">|</span> meanHet <span class="sc">&gt;</span> upper_meanHet),</span>
<span id="cb32-2"><a href="sample-qc.html#cb32-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">select =</span> <span class="fu">c</span>(<span class="st">&quot;FID&quot;</span>, <span class="st">&quot;IID&quot;</span>))</span>
<span id="cb32-3"><a href="sample-qc.html#cb32-3" aria-hidden="true" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">fwrite</span>(raw_IMISSHETsub, <span class="fu">paste0</span>(COURSE_loc,<span class="st">&quot;/rawdata/fail-raw_IMISSHETsub.txt&quot;</span>), <span class="at">sep =</span><span class="st">&quot; &quot;</span>)</span></code></pre></div>
</div>
<div id="relatedness" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Relatedness<a href="sample-qc.html#relatedness" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We calculate Identity-by-Descent (IBS), to identify duplicated and related samples (<strong>Table 2</strong>). IBS is measured by calculating pi-hat, which is in essence the proportion of the DNA that a pair of samples share. To calculate this, we needed this ultraclean dataset, without low-quality SNPs and without high-LD regions. Now we are ready</p>
<table>
<thead>
<tr class="header">
<th><strong>Relation</strong></th>
<th><strong>% DNA sharing</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Monozygotic twins</td>
<td>±100%</td>
</tr>
<tr class="even">
<td>Parents/child</td>
<td>±50%</td>
</tr>
<tr class="odd">
<td>Sibling</td>
<td>±50%</td>
</tr>
<tr class="even">
<td>Fraternal twins</td>
<td>±50%</td>
</tr>
<tr class="odd">
<td>Grandparent/grandchild</td>
<td>±25%</td>
</tr>
<tr class="even">
<td>Aunt/Uncle/Niece/Nephew</td>
<td>±25%</td>
</tr>
<tr class="odd">
<td>Half-sibling</td>
<td>±25%</td>
</tr>
<tr class="even">
<td>First-cousin</td>
<td>±12.5%</td>
</tr>
<tr class="odd">
<td>Half first-cousin</td>
<td>±6.25%</td>
</tr>
<tr class="even">
<td>First-cousin once removed</td>
<td>±6.25%</td>
</tr>
<tr class="odd">
<td>Second-cousin</td>
<td>±3.13%</td>
</tr>
<tr class="even">
<td>Second-cousin once removed</td>
<td>±1.56%</td>
</tr>
</tbody>
</table>
<p><strong>Table 2:</strong> Familial relations and % DNA shared.</p>
<pre><code>plink --bfile rawdata/rawdata.clean.ultraclean --genome --out rawdata/rawdata.clean.ultraclean</code></pre>
<p>We can now identify all pairs of individuals with an IBD &gt; 0.185. The code looks at the individual call rates stored in rawdata.imiss and outputs the IDs of the individual with the lowest call rate to ‘fail-IBD-QC.txt’ for subsequent removal.</p>
<pre><code>cd rawdata

perl ../scripts/run-IBD-QC.pl rawdata rawdata.clean.ultraclean

cd ..
</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="sample-qc.html#cb35-1" aria-hidden="true" tabindex="-1"></a>ibdcallissues <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="fu">paste0</span>(COURSE_loc,<span class="st">&quot;/rawdata/fail-IBD-QC.txt&quot;</span>))</span>
<span id="cb35-2"><a href="sample-qc.html#cb35-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(ibdcallissues, <span class="at">caption =</span> <span class="st">&quot;Failed IBD and callrate&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-5">Table 4.2: </span>Failed IBD and callrate</caption>
<thead>
<tr class="header">
<th align="right">V1</th>
<th align="right">V2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1952</td>
<td align="right">1952</td>
</tr>
<tr class="even">
<td align="right">1953</td>
<td align="right">1953</td>
</tr>
<tr class="odd">
<td align="right">1954</td>
<td align="right">1954</td>
</tr>
<tr class="even">
<td align="right">1955</td>
<td align="right">1955</td>
</tr>
<tr class="odd">
<td align="right">1957</td>
<td align="right">1957</td>
</tr>
<tr class="even">
<td align="right">1959</td>
<td align="right">1959</td>
</tr>
<tr class="odd">
<td align="right">1961</td>
<td align="right">1961</td>
</tr>
<tr class="even">
<td align="right">1963</td>
<td align="right">1963</td>
</tr>
<tr class="odd">
<td align="right">1965</td>
<td align="right">1965</td>
</tr>
<tr class="even">
<td align="right">1967</td>
<td align="right">1967</td>
</tr>
<tr class="odd">
<td align="right">1969</td>
<td align="right">1969</td>
</tr>
<tr class="even">
<td align="right">1971</td>
<td align="right">1971</td>
</tr>
<tr class="odd">
<td align="right">1973</td>
<td align="right">1973</td>
</tr>
<tr class="even">
<td align="right">1975</td>
<td align="right">1975</td>
</tr>
</tbody>
</table>
</div>
<div id="ancestral-background" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Ancestral background<a href="sample-qc.html#ancestral-background" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="hapmap-3" class="section level3 hasAnchor" number="4.5.1">
<h3><span class="header-section-number">4.5.1</span> HapMap 3<a href="sample-qc.html#hapmap-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We will project our data to a reference, in this example HapMap Phase II (HapMap3), which includes individuals from four distinct global populations, but it could also be 1000G phase 1. Or any other reference depending on the dataset.</p>
<p>To this end we will merge our data with HapMap3. The alleles at each marker must be aligned to the same DNA strand to allow our data to merge correctly. Because not all SNPs are required for this analysis, A-&gt;T and C-&gt;G SNPs, which are more difficult to align, can be omitted.</p>
<p>Let’s start by creating a new BED file, excluding from the GWA data those SNPs that do not feature in the genotype data of the four original HapMap3 populations.</p>
<pre><code>plink --bfile rawdata/rawdata --extract reference/hapmap3r2_CEU.CHB.JPT.YRI.no-at-cg-snps.txt --make-bed --out rawdata/rawdata.hm3</code></pre>
<p>Now, let’s try to merge <code>rawdata/rawdata.hm3</code> with the HapMap data and extract the pruned SNP set from above.</p>
<pre><code>plink --bfile rawdata/rawdata.hm3 --bmerge reference/hapmap3r2_CEU.CHB.JPT.YRI.founders.no-at-cg-snps --extract rawdata/raw-GWA-data.prune.in --make-bed --out rawdata/rawdata.hapmap3r2.pruned</code></pre>
<p>You probably get an error like below:</p>
<pre><code>Error: 59 variants with 3+ alleles present.
* If you believe this is due to strand inconsistency, try --flip with
  rawdata/rawdata.hapmap3r2.pruned-merge.missnp.
  (Warning: if this seems to work, strand errors involving SNPs with A/T or C/G
  alleles probably remain in your data.  If LD between nearby SNPs is high,
  --flip-scan should detect them.)
* If you are dealing with genuine multiallelic variants, we recommend exporting
  that subset of the data to VCF (via e.g. &#39;--recode vcf&#39;), merging with
  another tool/script, and then importing the result; PLINK is not yet suited
  to handling them.</code></pre>
<p>Because all A-&gt;T and C-&gt;G SNPs have been removed before undertaking this analysis, all other SNPs that are discordant for DNA strands between the two data sets are listed in the <code>rawdata.hapmap3r2.pruned-merge.missnp</code> file. To align the strands across the data sets and successfully complete the merge, we can do the following:</p>
<pre><code>plink --bfile rawdata/rawdata --extract reference/hapmap3r2_CEU.CHB.JPT.YRI.no-at-cg-snps.txt --flip rawdata/rawdata.hapmap3r2.pruned-merge.missnp --make-bed --out rawdata/rawdata.hm3</code></pre>
<p>And repeat this:</p>
<pre><code>plink --bfile rawdata/rawdata.hm3 --bmerge reference/hapmap3r2_CEU.CHB.JPT.YRI.founders.no-at-cg-snps --extract rawdata/raw-GWA-data.prune.in --make-bed --out rawdata/rawdata.hapmap3r2.pruned</code></pre>
<p>Let’s not be lazy and clean this dataset too.</p>
<pre><code>plink --bfile rawdata/rawdata.hapmap3r2.pruned \
--allow-no-sex --autosome \
--maf 0.10 --geno 0.10 --hwe 1e-3 \
--indep-pairwise 100 10 0.2 \
--exclude range rawdata/exclude_problematic_range.txt \
--make-bed --out rawdata/rawdata.hapmap3r2.pruned.clean</code></pre>
</div>
<div id="principal-component-analysis" class="section level3 hasAnchor" number="4.5.2">
<h3><span class="header-section-number">4.5.2</span> Principal Component Analysis<a href="sample-qc.html#principal-component-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Using a Principal Component Analysis (PCA) we can reduce the dimensions of the data, and project the “ancestral distances”. In other words, the principal component 1 (the first dimension) and principal component 2 (the second dimension) which will capture most of the variation in the data and represent how much each sample is alike the next.</p>
<p>First, we make a copy of the BIM and FAM-files.</p>
<pre><code>cp -v rawdata/rawdata.hapmap3r2.pruned.bim rawdata/rawdata.hapmap3r2.pruned.pedsnp
cp -v rawdata/rawdata.hapmap3r2.pruned.fam rawdata/rawdata.hapmap3r2.pruned.pedind</code></pre>
<div id="installing-eigensoft" class="section level4 hasAnchor" number="4.5.2.1">
<h4><span class="header-section-number">4.5.2.1</span> Installing EIGENSOFT<a href="sample-qc.html#installing-eigensoft" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Now, we are ready to perform the PCA using <code>smartPCA</code>. For this <code>EIGENSOFT</code> needs to be installed. Unfortunately, this doesn’t work on this VirtualMachine you are working on - you need <code>gsl</code>, <code>openblas</code> and <code>llvm</code> to make it work.</p>
<p><strong>Installing EIGENSOFT</strong></p>
<p>I am still sharing the code you’ll need - you could try this on your personal MacBook for instance.</p>
<pre><code>mkdir -v $HOME/git
cd $HOME/git
git clone https://github.com/DReichLab/EIG.git
cd EIG/src
make
make install</code></pre>
<p><strong>Executing smartPCA</strong></p>
<p>Should you run this on your personal laptop, be aware it will take a few minutes to do so - perfect moment for a cup of coffee or to stretch your legs.</p>
<pre><code>perl ~/git/EIG/bin/smartpca.perl \
-i rawdata/rawdata.hapmap3r2.pruned.bed \
-a rawdata/rawdata.hapmap3r2.pruned.pedsnp \
-b rawdata/rawdata.hapmap3r2.pruned.pedind \
-k 10 \
-o rawdata/rawdata.hapmap3r2.pruned.pca \
-p rawdata/rawdata.hapmap3r2.pruned.plot \
-e rawdata/rawdata.hapmap3r2.pruned.eval \
-l rawdata/rawdata.hapmap3r2.pruned.log \
-m 5 \
-t 10 \
-s 6.0 \
-w reference/hapmap3r2_CEU.CHB.JPT.YRI-pca-populations.txt</code></pre>
<p>See below an explanation of the above commands:</p>
<p><code>../bin/smartpca.perl</code></p>
<p>-i example.geno : genotype file in any format (see ../CONVERTF/README)
-a example.snp : snp file in any format (see ../CONVERTF/README)
-b example.ind : indiv file in any format (see ../CONVERTF/README)
-k k : (Default is 10) number of principal components to output
-o example.pca : output file of principal components. Individuals removed
as outliers will have all values set to 0.0 in this file.
-p example.plot : prefix of output plot files of top 2 principal components.
(labeling individuals according to labels in indiv file)
-e example.eval : output file of all eigenvalues
-l example.log : output logfile
-m maxiter : (Default is 5) maximum number of outlier removal iterations.
To turn off outlier removal, set -m 0.
-t topk : (Default is 10) number of principal components along which
to remove outliers during each outlier removal iteration.
-s sigma : (Default is 6.0) number of standard deviations which an
individual must exceed, along one of topk top principal
components, in order to be removed as an outlier.</p>
<p>OPTIONAL FLAGS:
-w poplist : compute eigenvectors using populations in poplist only,
where poplist is an ASCII file with one population per line
-y plotlist : output plot will include populations in plotlist only,
where plotlist is an ASCII file with one population per line
-z badsnpname : list of SNPs which should be excluded from the analysis
-q YES/NO : If set to YES, assume that there is a single population and
the population field contains real-valued phenotypes.
(Corresponds to qtmode parameter in smartpca program.)
The default value for this parameter is NO.</p>
<blockquote>
<p>NOTE: I made sure that in your download the results from this analysis are available for usage. That is:</p>
<ul>
<li>rawdata/rawdata.hapmap3r2.pruned.evec</li>
<li>rawdata/rawdata.hapmap3r2.pruned.par</li>
</ul>
</blockquote>
</div>
<div id="pca-plotting" class="section level4 hasAnchor" number="4.5.2.2">
<h4><span class="header-section-number">4.5.2.2</span> PCA plotting<a href="sample-qc.html#pca-plotting" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Now that we have calculated PCs, we can start plotting them. Let’s create a scatter diagram of the first two principal components, including all individuals in the file <code>rawdata.hapmap3r2.pruned.pca.evec</code> (the first and second principal components are columns 2 and 3, respectively). Use the data in column 4 to color the points according to sample origin. An R script for creating this plot (<code>scripts/plot-pca-results.Rscript</code>) is provided (although any standard graphing software can be used).</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="sample-qc.html#cb45-1" aria-hidden="true" tabindex="-1"></a>PCA <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="fu">paste0</span>(COURSE_loc,<span class="st">&quot;/rawdata/rawdata.hapmap3r2.pruned.pca.evec&quot;</span>), <span class="at">header =</span> <span class="cn">FALSE</span>, <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb45-2"><a href="sample-qc.html#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="sample-qc.html#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Case/Control -&gt; black, pch = &quot;+&quot;</span></span>
<span id="cb45-4"><a href="sample-qc.html#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># CEU = 3 -&gt; red, pch = 20</span></span>
<span id="cb45-5"><a href="sample-qc.html#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co"># CHB = 4 -&gt; pink, pch = 20</span></span>
<span id="cb45-6"><a href="sample-qc.html#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co"># JPT = 5 -&gt; purple, pch = 20</span></span>
<span id="cb45-7"><a href="sample-qc.html#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co"># YRI = 6 -&gt; green, pch = 20</span></span>
<span id="cb45-8"><a href="sample-qc.html#cb45-8" aria-hidden="true" tabindex="-1"></a>PCA<span class="sc">$</span>V12[PCA<span class="sc">$</span>V12 <span class="sc">==</span> <span class="st">&quot;Case&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Case&quot;</span> <span class="co">#595A5C</span></span>
<span id="cb45-9"><a href="sample-qc.html#cb45-9" aria-hidden="true" tabindex="-1"></a>PCA<span class="sc">$</span>V12[PCA<span class="sc">$</span>V12 <span class="sc">==</span> <span class="st">&quot;Control&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Control&quot;</span> <span class="co">#595A5C</span></span>
<span id="cb45-10"><a href="sample-qc.html#cb45-10" aria-hidden="true" tabindex="-1"></a>PCA<span class="sc">$</span>V12[PCA<span class="sc">$</span>V12 <span class="sc">==</span> <span class="st">&quot;3&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;CEU&quot;</span> <span class="co">#E55738</span></span>
<span id="cb45-11"><a href="sample-qc.html#cb45-11" aria-hidden="true" tabindex="-1"></a>PCA<span class="sc">$</span>V12[PCA<span class="sc">$</span>V12 <span class="sc">==</span> <span class="st">&quot;4&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;CHB&quot;</span> <span class="co">#D5267B</span></span>
<span id="cb45-12"><a href="sample-qc.html#cb45-12" aria-hidden="true" tabindex="-1"></a>PCA<span class="sc">$</span>V12[PCA<span class="sc">$</span>V12 <span class="sc">==</span> <span class="st">&quot;5&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;JPT&quot;</span> <span class="co">#9A3480</span></span>
<span id="cb45-13"><a href="sample-qc.html#cb45-13" aria-hidden="true" tabindex="-1"></a>PCA<span class="sc">$</span>V12[PCA<span class="sc">$</span>V12 <span class="sc">==</span> <span class="st">&quot;6&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;YRI&quot;</span> <span class="co">#49A01D</span></span>
<span id="cb45-14"><a href="sample-qc.html#cb45-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-15"><a href="sample-qc.html#cb45-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-16"><a href="sample-qc.html#cb45-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-17"><a href="sample-qc.html#cb45-17" aria-hidden="true" tabindex="-1"></a>PCAplot <span class="ot">&lt;-</span> ggpubr<span class="sc">::</span><span class="fu">ggscatter</span>(PCA, <span class="at">x =</span> <span class="st">&quot;V2&quot;</span>, <span class="at">y =</span> <span class="st">&quot;V3&quot;</span>,</span>
<span id="cb45-18"><a href="sample-qc.html#cb45-18" aria-hidden="true" tabindex="-1"></a>                             <span class="at">color =</span> <span class="st">&quot;V12&quot;</span>,</span>
<span id="cb45-19"><a href="sample-qc.html#cb45-19" aria-hidden="true" tabindex="-1"></a>                             <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">&quot;#595A5C&quot;</span>, <span class="st">&quot;#595A5C&quot;</span>, <span class="st">&quot;#E55738&quot;</span>, <span class="st">&quot;#D5267B&quot;</span>, <span class="st">&quot;#9A3480&quot;</span>, <span class="st">&quot;#49A01D&quot;</span>),</span>
<span id="cb45-20"><a href="sample-qc.html#cb45-20" aria-hidden="true" tabindex="-1"></a>                             <span class="at">shape =</span> <span class="st">&quot;V12&quot;</span>,</span>
<span id="cb45-21"><a href="sample-qc.html#cb45-21" aria-hidden="true" tabindex="-1"></a>                             <span class="at">xlab =</span> <span class="st">&quot;principal component 1&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;principal component 2&quot;</span>) <span class="sc">+</span></span>
<span id="cb45-22"><a href="sample-qc.html#cb45-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.075</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb45-23"><a href="sample-qc.html#cb45-23" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">&quot;#A2A3A4&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb45-24"><a href="sample-qc.html#cb45-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-25"><a href="sample-qc.html#cb45-25" aria-hidden="true" tabindex="-1"></a>  ggpubr<span class="sc">::</span><span class="fu">ggpar</span>(PCAplot,</span>
<span id="cb45-26"><a href="sample-qc.html#cb45-26" aria-hidden="true" tabindex="-1"></a>                <span class="at">title =</span> <span class="st">&quot;Principal Component Analysis&quot;</span>,</span>
<span id="cb45-27"><a href="sample-qc.html#cb45-27" aria-hidden="true" tabindex="-1"></a>                <span class="at">subtitle =</span> <span class="st">&quot;Reference population: HapMap 3&quot;</span>,</span>
<span id="cb45-28"><a href="sample-qc.html#cb45-28" aria-hidden="true" tabindex="-1"></a>                <span class="at">legend.title =</span> <span class="st">&quot;Populations&quot;</span>, <span class="at">legend =</span> <span class="st">&quot;right&quot;</span>)</span></code></pre></div>
<p><img src="A-primer-in-Human-Cardiovascular-Genetics_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>Derive PC1 and PC2 thresholds so that only individuals who match the given ancestral population are included. For populations of European descent, this will be either the CEU or TSI HapMap3 individuals. Here, we chose to exclude all individuals with a second principal component score less than 0.072.</p>
<p>Write the FID and IID of these individuals to a file called <code>fail-ancestry-QC.txt</code>.</p>
<pre><code>cat rawdata/rawdata.hapmap3r2.pruned.pca.evec | tail -n +2 | \
awk &#39;$3 &lt; 0.075&#39; | awk &#39;{ print $1 }&#39; | awk -F&quot;:&quot; &#39;{ print $1, $2 }&#39; &gt; rawdata/fail-ancestry-QC.txt</code></pre>
<p>Choosing which thresholds to apply (and thus which individuals to remove) is not a straightforward process. The key is to remove those individuals with greatly divergent ancestry, as these samples introduce the most bias to the study. Identification of more fine-scale ancestry can be conducted by using less divergent reference samples (<em>e.g.</em>, within Europe, stratification could be identified using the CEU, TSI (Italian), GBR (British), FIN (Finnish) and IBS (Iberian) samples from the 1,000 Genomes Project (<a href="http://www.1000genomes.org/" class="uri">http://www.1000genomes.org/</a>)). Robust identification of fine-scale population structure often requires the construction of many (2–10) principal components.</p>
</div>
</div>
<div id="g-phase-1" class="section level3 hasAnchor" number="4.5.3">
<h3><span class="header-section-number">4.5.3</span> 1000G phase 1<a href="sample-qc.html#g-phase-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You could do the above again but now with projecting the 1000G phase 1 populations. The all the 1000G phase 1 data is provided as tutorial data (), as well as a subset including <em>only</em> the variants in our <code>rawdata</code>. You can try and run the PCA with 1000G and project the results – let’s do that in our spare time and continue for now with the QC based on HM3. But please, do show us the results tomorrow … :-) For your convenience there are some codes below which you may need.</p>
<p>Get a list of relevant variants.</p>
<pre><code>cat rawdata/rawdata.bim | grep &quot;rs&quot; &gt; rawdata/all.variants.txt</code></pre>
<p>Extract those from the 1000G phase 1 data.</p>
<pre><code>plink --bfile reference/1kg_phase1_all/1kg_phase1_all --extract rawdata/all.variants.txt --make-bed --out reference/1kg_phase1_all/1kg_phase1_raw</code></pre>
<p>Get a list of A/T and C/G variants from 1000G to exclude.</p>
<pre><code>cat reference/1kg_phase1_all/1kg_phase1_raw.bim | \
awk &#39;($5 == &quot;A&quot; &amp;&amp; $6 == &quot;T&quot;) || ($5 == &quot;T&quot; &amp;&amp; $6 == &quot;A&quot;) || ($5 == &quot;C&quot; &amp;&amp; $6 == &quot;G&quot;) || ($5 == &quot;G&quot; &amp;&amp; $6 == &quot;C&quot;)&#39; | awk &#39;{ print $2, $1, $4, $3, $5, $6 }&#39; \
&gt; reference/1kg_phase1_all/all.1kg.atcg.variants.txt</code></pre>
<p>Exclude those A/T and C/G variants in both datasets.</p>
<pre><code>plink --bfile reference/1kg_phase1_all/1kg_phase1_raw --exclude reference/1kg_phase1_all/all.1kg.atcg.variants.txt --make-bed --out reference/1kg_phase1_all/1kg_phase1_raw_no_atcg

plink --bfile rawdata/rawdata --exclude reference/1kg_phase1_all/all.1kg.atcg.variants.txt --make-bed --out rawdata/rawdata_1kg_phase1_raw_no_atcg</code></pre>
<p>Try and merge the data while extracting the pruned SNP-set.</p>
<pre><code>plink --bfile rawdata/rawdata_1kg_phase1_raw_no_atcg --bmerge reference/1kg_phase1_all/1kg_phase1_raw_no_atcg --extract rawdata/raw-GWA-data.prune.in --make-bed --out rawdata/rawdata.1kg_phase1.pruned</code></pre>
<p>There probably is an error …</p>
<pre><code>Error: 72 variants with 3+ alleles present.
* If you believe this is due to strand inconsistency, try --flip with
  rawdata/rawdata.1kg_phase1.pruned-merge.missnp.
  (Warning: if this seems to work, strand errors involving SNPs with A/T or C/G
  alleles probably remain in your data.  If LD between nearby SNPs is high,
  --flip-scan should detect them.)
* If you are dealing with genuine multiallelic variants, we recommend exporting
  that subset of the data to VCF (via e.g. &#39;--recode vcf&#39;), merging with
  another tool/script, and then importing the result; PLINK is not yet suited
  to handling them.
See https://www.cog-genomics.org/plink/1.9/data#merge3 for more discussion.</code></pre>
<p>So let’s flip some variants.</p>
<pre><code>plink --bfile rawdata/rawdata --exclude reference/1kg_phase1_all/all.1kg.atcg.variants.txt --flip rawdata/rawdata.1kg_phase1.pruned-merge.missnp --make-bed --out rawdata/rawdata_1kg_phase1_raw_no_atcg</code></pre>
<p>Let’s try and merge the data while extracting the pruned SNP-set.</p>
<pre><code>plink --bfile rawdata/rawdata_1kg_phase1_raw_no_atcg --bmerge reference/1kg_phase1_all/1kg_phase1_raw_no_atcg --extract rawdata/raw-GWA-data.prune.in --make-bed --out rawdata/rawdata.1kg_phase1.pruned</code></pre>
<p>There still is an error – there are multi-allelic variants present which PLINK can’t handle.</p>
<pre><code>Error: 14 variants with 3+ alleles present.
* If you believe this is due to strand inconsistency, try --flip with
  rawdata/rawdata.1kg_phase1.pruned-merge.missnp.
  (Warning: if this seems to work, strand errors involving SNPs with A/T or C/G
  alleles probably remain in your data.  If LD between nearby SNPs is high,
  --flip-scan should detect them.)
* If you are dealing with genuine multiallelic variants, we recommend exporting
  that subset of the data to VCF (via e.g. &#39;--recode vcf&#39;), merging with
  another tool/script, and then importing the result; PLINK is not yet suited
  to handling them.
See https://www.cog-genomics.org/plink/1.9/data#merge3 for more discussion.</code></pre>
<p>Let’s just remove these multi-allelic variants.</p>
<pre><code>plink --bfile rawdata/rawdata_1kg_phase1_raw_no_atcg --exclude rawdata/rawdata.1kg_phase1.pruned-merge.missnp --make-bed --out rawdata/rawdata_1kg_phase1_raw_no_atcg_bi</code></pre>
<p>Now we should be able to merge the data…</p>
<pre><code>plink --bfile rawdata/rawdata_1kg_phase1_raw_no_atcg_bi --bmerge reference/1kg_phase1_all/1kg_phase1_raw_no_atcg --extract rawdata/raw-GWA-data.prune.in --make-bed --out rawdata/rawdata.1kg_phase1.pruned</code></pre>
<p>That worked! Let’s run a PCA.</p>
<pre><code>cp -v rawdata/rawdata.1kg_phase1.pruned.bim rawdata/rawdata.1kg_phase1.pruned.pedsnp
cp -v rawdata/rawdata.1kg_phase1.pruned.fam rawdata/rawdata.1kg_phase1.pruned.pedind</code></pre>
<pre><code>perl ~/git/EIG/bin/smartpca.perl \
-i rawdata/rawdata.1kg_phase1.pruned.bed \
-a rawdata/rawdata.1kg_phase1.pruned.pedsnp \
-b rawdata/rawdata.1kg_phase1.pruned.pedind \
-k 10 \
-o rawdata/rawdata.1kg_phase1.pruned.pca \
-p rawdata/rawdata.1kg_phase1.pruned.plot \
-e rawdata/rawdata.1kg_phase1.pruned.eval \
-l rawdata/rawdata.1kg_phase1.pruned.log \
-m 5 \
-t 10 \
-s 6.0 \
-w reference/1kg_phase1_all/1kg-pca-populations.txt</code></pre>
<!-- I get an error when I run this. No clue why - but it's a segmentation fault.  -->
<!-- perl ~/git/EIG/bin/smartpca.perl -i rawdata/rawdata.1kg_phase1.pruned.bed -a rawdata/rawdata.1kg_phase1.pruned.pedsnp -b rawdata/rawdata.1kg_phase1.pruned.pedind -k 10 -o rawdata/rawdata.1kg_phase1.pruned.pca -p rawdata/rawdata.1kg_phase1.pruned.plot -e rawdata/rawdata.1kg_phase1.pruned.eval -l rawdata/rawdata.1kg_phase1.pruned.log -m 5 -t 10 -s 6.0 -w reference/1kg_phase1_all/1kg-pca-populations.txt -->
<!-- smartpca -p rawdata/rawdata.1kg_phase1.pruned.pca.par >rawdata/rawdata.1kg_phase1.pruned.log -->
<!-- sh: line 1: 37485 Segmentation fault: 11  smartpca -p rawdata/rawdata.1kg_phase1.pruned.pca.par > rawdata/rawdata.1kg_phase1.pruned.log -->
<!-- ploteig -i rawdata/rawdata.1kg_phase1.pruned.pca.evec -c 1:2  -p   -x  -y  -o rawdata/rawdata.1kg_phase1.pruned.plot.xtxt -->
<!-- evec2pca.perl 10 rawdata/rawdata.1kg_phase1.pruned.pca.evec rawdata/rawdata.1kg_phase1.pruned.pedind rawdata/rawdata.1kg_phase1.pruned.pca -->
<p>And we can try to plot this result as well.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="sample-qc.html#cb60-1" aria-hidden="true" tabindex="-1"></a>PCA_1kG <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="fu">paste0</span>(COURSE_loc,<span class="st">&quot;/rawdata/rawdata.1kg_phase1.pruned.pca.evec&quot;</span>), <span class="at">header =</span> <span class="cn">FALSE</span>, <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb60-2"><a href="sample-qc.html#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="sample-qc.html#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Population    Description Super population    Code    Counts</span></span>
<span id="cb60-4"><a href="sample-qc.html#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ASW   African Ancestry in Southwest US                              AFR   4     #49A01D</span></span>
<span id="cb60-5"><a href="sample-qc.html#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="co"># CEU   Utah residents with Northern and Western European ancestry  EUR 7     #E55738</span></span>
<span id="cb60-6"><a href="sample-qc.html#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="co"># CHB   Han Chinese in Bejing, China                                  EAS   8     #9A3480</span></span>
<span id="cb60-7"><a href="sample-qc.html#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="co"># CHS   Southern Han Chinese, China                                 EAS 9     #705296</span></span>
<span id="cb60-8"><a href="sample-qc.html#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="co"># CLM   Colombian in Medellin, Colombia                             MR  10  #8D5B9A</span></span>
<span id="cb60-9"><a href="sample-qc.html#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="co"># FIN   Finnish in Finland                                          EUR 12  #2F8BC9</span></span>
<span id="cb60-10"><a href="sample-qc.html#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="co"># GBR   British in England and Scotland                             EUR 13  #1290D9</span></span>
<span id="cb60-11"><a href="sample-qc.html#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="co"># IBS   Iberian populations in Spain                                  EUR   16  #1396D8</span></span>
<span id="cb60-12"><a href="sample-qc.html#cb60-12" aria-hidden="true" tabindex="-1"></a><span class="co"># JPT   Japanese in Tokyo, Japan                                      EAS   18  #D5267B</span></span>
<span id="cb60-13"><a href="sample-qc.html#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="co"># LWK   Luhya in Webuye, Kenya                                      AFR 20  #78B113</span></span>
<span id="cb60-14"><a href="sample-qc.html#cb60-14" aria-hidden="true" tabindex="-1"></a><span class="co"># MXL   Mexican Ancestry in Los Angeles, California                 AMR 22  #F59D10</span></span>
<span id="cb60-15"><a href="sample-qc.html#cb60-15" aria-hidden="true" tabindex="-1"></a><span class="co"># PUR   Puerto Rican in Puerto Rico                                 AMR 25  #FBB820</span></span>
<span id="cb60-16"><a href="sample-qc.html#cb60-16" aria-hidden="true" tabindex="-1"></a><span class="co"># TSI   Toscani in Italy                                              EUR   27  #4C81BF</span></span>
<span id="cb60-17"><a href="sample-qc.html#cb60-17" aria-hidden="true" tabindex="-1"></a><span class="co"># YRI   Yoruba in Ibadan, Nigeria                                     AFR   28  #C5D220</span></span>
<span id="cb60-18"><a href="sample-qc.html#cb60-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-19"><a href="sample-qc.html#cb60-19" aria-hidden="true" tabindex="-1"></a>PCA_1kG<span class="sc">$</span>V12[PCA_1kG<span class="sc">$</span>V12 <span class="sc">==</span> <span class="st">&quot;Case&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Case&quot;</span></span>
<span id="cb60-20"><a href="sample-qc.html#cb60-20" aria-hidden="true" tabindex="-1"></a>PCA_1kG<span class="sc">$</span>V12[PCA_1kG<span class="sc">$</span>V12 <span class="sc">==</span> <span class="st">&quot;Control&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Control&quot;</span></span>
<span id="cb60-21"><a href="sample-qc.html#cb60-21" aria-hidden="true" tabindex="-1"></a>PCA_1kG<span class="sc">$</span>V12[PCA_1kG<span class="sc">$</span>V12 <span class="sc">==</span> <span class="st">&quot;4&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;ASW&quot;</span></span>
<span id="cb60-22"><a href="sample-qc.html#cb60-22" aria-hidden="true" tabindex="-1"></a>PCA_1kG<span class="sc">$</span>V12[PCA_1kG<span class="sc">$</span>V12 <span class="sc">==</span> <span class="st">&quot;7&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;CEU&quot;</span></span>
<span id="cb60-23"><a href="sample-qc.html#cb60-23" aria-hidden="true" tabindex="-1"></a>PCA_1kG<span class="sc">$</span>V12[PCA_1kG<span class="sc">$</span>V12 <span class="sc">==</span> <span class="st">&quot;8&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;CHB&quot;</span></span>
<span id="cb60-24"><a href="sample-qc.html#cb60-24" aria-hidden="true" tabindex="-1"></a>PCA_1kG<span class="sc">$</span>V12[PCA_1kG<span class="sc">$</span>V12 <span class="sc">==</span> <span class="st">&quot;9&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;CHS&quot;</span></span>
<span id="cb60-25"><a href="sample-qc.html#cb60-25" aria-hidden="true" tabindex="-1"></a>PCA_1kG<span class="sc">$</span>V12[PCA_1kG<span class="sc">$</span>V12 <span class="sc">==</span> <span class="st">&quot;10&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;CLM&quot;</span></span>
<span id="cb60-26"><a href="sample-qc.html#cb60-26" aria-hidden="true" tabindex="-1"></a>PCA_1kG<span class="sc">$</span>V12[PCA_1kG<span class="sc">$</span>V12 <span class="sc">==</span> <span class="st">&quot;12&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;FIN&quot;</span></span>
<span id="cb60-27"><a href="sample-qc.html#cb60-27" aria-hidden="true" tabindex="-1"></a>PCA_1kG<span class="sc">$</span>V12[PCA_1kG<span class="sc">$</span>V12 <span class="sc">==</span> <span class="st">&quot;13&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;GBR&quot;</span></span>
<span id="cb60-28"><a href="sample-qc.html#cb60-28" aria-hidden="true" tabindex="-1"></a>PCA_1kG<span class="sc">$</span>V12[PCA_1kG<span class="sc">$</span>V12 <span class="sc">==</span> <span class="st">&quot;16&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;IBS&quot;</span></span>
<span id="cb60-29"><a href="sample-qc.html#cb60-29" aria-hidden="true" tabindex="-1"></a>PCA_1kG<span class="sc">$</span>V12[PCA_1kG<span class="sc">$</span>V12 <span class="sc">==</span> <span class="st">&quot;18&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;JPT&quot;</span></span>
<span id="cb60-30"><a href="sample-qc.html#cb60-30" aria-hidden="true" tabindex="-1"></a>PCA_1kG<span class="sc">$</span>V12[PCA_1kG<span class="sc">$</span>V12 <span class="sc">==</span> <span class="st">&quot;20&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;LWK&quot;</span></span>
<span id="cb60-31"><a href="sample-qc.html#cb60-31" aria-hidden="true" tabindex="-1"></a>PCA_1kG<span class="sc">$</span>V12[PCA_1kG<span class="sc">$</span>V12 <span class="sc">==</span> <span class="st">&quot;22&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;MXL&quot;</span></span>
<span id="cb60-32"><a href="sample-qc.html#cb60-32" aria-hidden="true" tabindex="-1"></a>PCA_1kG<span class="sc">$</span>V12[PCA_1kG<span class="sc">$</span>V12 <span class="sc">==</span> <span class="st">&quot;25&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;PUR&quot;</span></span>
<span id="cb60-33"><a href="sample-qc.html#cb60-33" aria-hidden="true" tabindex="-1"></a>PCA_1kG<span class="sc">$</span>V12[PCA_1kG<span class="sc">$</span>V12 <span class="sc">==</span> <span class="st">&quot;27&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;TSI&quot;</span></span>
<span id="cb60-34"><a href="sample-qc.html#cb60-34" aria-hidden="true" tabindex="-1"></a>PCA_1kG<span class="sc">$</span>V12[PCA_1kG<span class="sc">$</span>V12 <span class="sc">==</span> <span class="st">&quot;28&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;YRI&quot;</span></span>
<span id="cb60-35"><a href="sample-qc.html#cb60-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-36"><a href="sample-qc.html#cb60-36" aria-hidden="true" tabindex="-1"></a>PCA_1kGplot <span class="ot">&lt;-</span> ggpubr<span class="sc">::</span><span class="fu">ggscatter</span>(PCA_1kG, <span class="at">x =</span> <span class="st">&quot;V2&quot;</span>, <span class="at">y =</span> <span class="st">&quot;V3&quot;</span>,</span>
<span id="cb60-37"><a href="sample-qc.html#cb60-37" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">color =</span> <span class="st">&quot;V12&quot;</span>,</span>
<span id="cb60-38"><a href="sample-qc.html#cb60-38" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">&quot;#595A5C&quot;</span>, <span class="st">&quot;#49A01D&quot;</span>, <span class="st">&quot;#E55738&quot;</span>, <span class="st">&quot;#9A3480&quot;</span>, <span class="st">&quot;#705296&quot;</span>, <span class="st">&quot;#595A5C&quot;</span>, <span class="st">&quot;#8D5B9A&quot;</span>, <span class="st">&quot;#2F8BC9&quot;</span>, <span class="st">&quot;#1290D9&quot;</span>, <span class="st">&quot;#1396D8&quot;</span>, <span class="st">&quot;#D5267B&quot;</span>, <span class="st">&quot;#78B113&quot;</span>, <span class="st">&quot;#F59D10&quot;</span>, <span class="st">&quot;#FBB820&quot;</span>, <span class="st">&quot;#4C81BF&quot;</span>, <span class="st">&quot;#C5D220&quot;</span>),</span>
<span id="cb60-39"><a href="sample-qc.html#cb60-39" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">xlab =</span> <span class="st">&quot;principal component 1&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;principal component 2&quot;</span>) <span class="sc">+</span></span>
<span id="cb60-40"><a href="sample-qc.html#cb60-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.023</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb60-41"><a href="sample-qc.html#cb60-41" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">&quot;#595A5C&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb60-42"><a href="sample-qc.html#cb60-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-43"><a href="sample-qc.html#cb60-43" aria-hidden="true" tabindex="-1"></a>  ggpubr<span class="sc">::</span><span class="fu">ggpar</span>(PCA_1kGplot,</span>
<span id="cb60-44"><a href="sample-qc.html#cb60-44" aria-hidden="true" tabindex="-1"></a>                <span class="at">title =</span> <span class="st">&quot;Principal Component Analysis&quot;</span>,</span>
<span id="cb60-45"><a href="sample-qc.html#cb60-45" aria-hidden="true" tabindex="-1"></a>                <span class="at">subtitle =</span> <span class="st">&quot;Reference population: 1000 G, phase 1&quot;</span>,</span>
<span id="cb60-46"><a href="sample-qc.html#cb60-46" aria-hidden="true" tabindex="-1"></a>                <span class="at">legend.title =</span> <span class="st">&quot;Populations&quot;</span>, <span class="at">legend =</span> <span class="st">&quot;right&quot;</span>)</span></code></pre></div>
<p><img src="A-primer-in-Human-Cardiovascular-Genetics_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>In a similar fashion as in the above with the HapMap3 reference, you could remove the samples below the threshold.</p>
</div>
</div>
<div id="removing-samples" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> Removing samples<a href="sample-qc.html#removing-samples" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Finally! We have a list of samples of poor quality or divergent ancestry, and duplicated or related samples. We should remove these. Let’s collect all IDs from our <code>fail-*</code>-files into a single file.</p>
<pre><code>cat rawdata/fail-* | sort -k1 | uniq &gt; rawdata/fail-qc-inds.txt</code></pre>
<p>This new file should now contain a list of unique individuals failing the previous QC steps which we want to remove.</p>
<pre><code>plink --bfile rawdata/rawdata --remove rawdata/fail-qc-inds.txt --make-bed --out rawdata/clean_inds_data</code></pre>
<!-- To remove them from the data set, type `plink --bfile raw-GWA-data --remove fail-qc-inds.txt --make-bed - -out clean-inds-GWA-data` at the Unix prompt. -->

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="basics-of-a-genome-wide-association-study-gwas.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="per-snp-qc.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/swvanderlaan/A_primer_in_Human_Cardiovascular_Genetics/edit/master/gwas_basics_sample_qc.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["A primer in Human Cardiovascular Genetics.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
